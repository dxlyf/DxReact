å¯¹äºä¸æ”¯æŒ `@container` çš„æµè§ˆå™¨ï¼Œæœ‰å¤šç§å›é€€æ–¹æ¡ˆã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆï¼š

## ğŸ¯ æ£€æµ‹æ”¯æŒå’Œé™çº§æ–¹æ¡ˆ

### 1. ç‰¹æ€§æ£€æµ‹å’Œé™çº§

```css
/* åŸºç¡€æ ·å¼ï¼ˆæ‰€æœ‰æµè§ˆå™¨ï¼‰ */
.card {
  display: block;
  padding: 16px;
  background: white;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.card-image {
  width: 100%;
  height: 160px;
  object-fit: cover;
  margin-bottom: 12px;
}

.card-content {
  text-align: center;
}

/* æ”¯æŒå®¹å™¨æŸ¥è¯¢çš„å¢å¼ºæ ·å¼ */
@supports (container-type: inline-size) {
  .card-container {
    container-type: inline-size;
    container-name: card;
  }
  
  @container card (min-width: 400px) {
    .card {
      display: flex;
      gap: 16px;
      text-align: left;
    }
    
    .card-image {
      width: 120px;
      height: 120px;
      margin-bottom: 0;
      flex-shrink: 0;
    }
    
    .card-content {
      flex: 1;
      text-align: left;
    }
  }
  
  @container card (min-width: 600px) {
    .card {
      padding: 24px;
      flex-direction: column;
      text-align: center;
    }
    
    .card-image {
      width: 100%;
      height: 200px;
    }
  }
}
```

### 2. JavaScript ç‰¹æ€§æ£€æµ‹å’Œé™çº§

```javascript
// æ£€æµ‹å®¹å™¨æŸ¥è¯¢æ”¯æŒ
function supportsContainerQueries() {
  return CSS.supports('container-type', 'inline-size');
}

// å®¹å™¨æŸ¥è¯¢çš„ JavaScript é™çº§æ–¹æ¡ˆ
class ContainerQueryFallback {
  constructor(containerSelector, breakpoints) {
    this.containers = document.querySelectorAll(containerSelector);
    this.breakpoints = breakpoints;
    this.init();
  }
  
  init() {
    if (supportsContainerQueries()) {
      return; // æµè§ˆå™¨æ”¯æŒå®¹å™¨æŸ¥è¯¢ï¼Œä¸éœ€è¦é™çº§
    }
    
    this.observeContainers();
    window.addEventListener('resize', () => this.observeContainers());
  }
  
  observeContainers() {
    this.containers.forEach(container => {
      const width = container.offsetWidth;
      this.applyBreakpointClasses(container, width);
    });
  }
  
  applyBreakpointClasses(container, width) {
    // ç§»é™¤æ‰€æœ‰æ–­ç‚¹ç±»
    container.classList.remove(...Object.values(this.breakpoints));
    
    // æ ¹æ®å®½åº¦æ·»åŠ å¯¹åº”çš„ç±»
    for (const [breakpoint, className] of Object.entries(this.breakpoints)) {
      const minWidth = parseInt(breakpoint);
      if (width >= minWidth) {
        container.classList.add(className);
      }
    }
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const breakpoints = {
  '400': 'cq-min-400',
  '600': 'cq-min-600', 
  '800': 'cq-min-800'
};

new ContainerQueryFallback('.card-container', breakpoints);
```

```css
/* CSS é™çº§æ ·å¼ */
.card-container.cq-min-400 .card {
  display: flex;
  gap: 16px;
  text-align: left;
}

.card-container.cq-min-400 .card-image {
  width: 120px;
  height: 120px;
  margin-bottom: 0;
  flex-shrink: 0;
}

.card-container.cq-min-600 .card {
  padding: 24px;
  flex-direction: column;
  text-align: center;
}

.card-container.cq-min-600 .card-image {
  width: 100%;
  height: 200px;
}
```

## ğŸ› ï¸ å®ç”¨çš„é™çº§æ¨¡å¼

### 3. åŸºäº CSS Grid çš„é™çº§æ–¹æ¡ˆ

```css
/* ä½¿ç”¨ CSS Grid å®ç°ç±»ä¼¼å®¹å™¨æŸ¥è¯¢çš„æ•ˆæœ */
.component-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  padding: 20px;
}

.grid-item {
  /* åŸºç¡€ç§»åŠ¨ç«¯æ ·å¼ */
  background: white;
  padding: 16px;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* å½“ç½‘æ ¼é¡¹å®½åº¦å˜åŒ–æ—¶çš„æ ·å¼ */
.grid-item:nth-child(n) {
  /* é»˜è®¤å•åˆ—å¸ƒå±€çš„æ ·å¼ */
  text-align: center;
}

/* è¿‘ä¼¼å®¹å™¨æŸ¥è¯¢æ•ˆæœ - å½“é¡¹ç›®å˜å®½æ—¶ */
@media screen and (min-width: 768px) {
  .grid-item {
    /* ä¸­ç­‰å®½åº¦æ ·å¼ */
    display: flex;
    gap: 16px;
    text-align: left;
    padding: 20px;
  }
  
  .grid-item .image {
    width: 100px;
    height: 100px;
    flex-shrink: 0;
  }
}

/* å¦‚æœæ”¯æŒå®¹å™¨æŸ¥è¯¢ï¼Œä½¿ç”¨æ›´ç²¾ç¡®çš„æ§åˆ¶ */
@supports (container-type: inline-size) {
  .grid-item {
    container-type: inline-size;
    container-name: grid-item;
  }
  
  @container grid-item (min-width: 300px) {
    .content {
      display: flex;
      gap: 12px;
    }
  }
  
  @container grid-item (min-width: 400px) {
    .content {
      gap: 20px;
    }
    
    .image {
      width: 120px;
    }
  }
}
```

### 4. ResizeObserver + CSS ç±»æ–¹æ¡ˆ

```javascript
// æ›´ç²¾ç¡®çš„ ResizeObserver æ–¹æ¡ˆ
class ResizeObserverFallback {
  constructor() {
    this.breakpoints = [
      { min: 0, max: 399, class: 'cq-sm' },
      { min: 400, max: 599, class: 'cq-md' },
      { min: 600, max: 799, class: 'cq-lg' },
      { min: 800, max: Infinity, class: 'cq-xl' }
    ];
    
    this.observer = new ResizeObserver(entries => {
      entries.forEach(entry => {
        this.handleResize(entry.target, entry.contentRect.width);
      });
    });
  }
  
  observe(selector) {
    const elements = document.querySelectorAll(selector);
    elements.forEach(el => {
      // æ·»åŠ åŸºç¡€ç±»
      el.classList.add('cq-container');
      this.observer.observe(el);
      // åˆå§‹è®¾ç½®
      this.handleResize(el, el.offsetWidth);
    });
  }
  
  handleResize(element, width) {
    // ç§»é™¤æ‰€æœ‰æ–­ç‚¹ç±»
    this.breakpoints.forEach(bp => {
      element.classList.remove(bp.class);
    });
    
    // æ·»åŠ å½“å‰å®½åº¦å¯¹åº”çš„ç±»
    const breakpoint = this.breakpoints.find(bp => 
      width >= bp.min && width <= bp.max
    );
    
    if (breakpoint) {
      element.classList.add(breakpoint.class);
    }
  }
  
  disconnect() {
    this.observer.disconnect();
  }
}

// ä½¿ç”¨
const resizeFallback = new ResizeObserverFallback();
resizeFallback.observe('.card-container');
```

```css
/* å¯¹åº”çš„ CSS æ ·å¼ */
.cq-container.cq-sm .card {
  display: block;
  text-align: center;
  padding: 12px;
}

.cq-container.cq-md .card {
  display: flex;
  gap: 12px;
  text-align: left;
  padding: 16px;
}

.cq-container.cq-md .card-image {
  width: 80px;
  height: 80px;
  flex-shrink: 0;
}

.cq-container.cq-lg .card {
  display: flex;
  gap: 20px;
  padding: 20px;
}

.cq-container.cq-lg .card-image {
  width: 120px;
  height: 120px;
}

.cq-container.cq-xl .card {
  display: block;
  text-align: center;
  padding: 24px;
}

.cq-container.cq-xl .card-image {
  width: 100%;
  height: 160px;
}
```

## ğŸ“± å®é™…ç»„ä»¶ç¤ºä¾‹

### 5. å®Œæ•´çš„å¡ç‰‡ç»„ä»¶é™çº§æ–¹æ¡ˆ

```html
<!DOCTYPE html>
<html>
<head>
<style>
  /* åŸºç¡€æ ·å¼ - æ‰€æœ‰æµè§ˆå™¨ */
  .card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: all 0.3s ease;
  }
  
  .card-image {
    width: 100%;
    height: 200px;
    object-fit: cover;
  }
  
  .card-content {
    padding: 16px;
  }
  
  .card-title {
    font-size: 18px;
    font-weight: bold;
    margin-bottom: 8px;
  }
  
  .card-description {
    color: #666;
    line-height: 1.5;
    margin-bottom: 16px;
  }
  
  .card-actions {
    display: flex;
    gap: 8px;
  }
  
  .btn {
    padding: 8px 16px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    flex: 1;
  }
  
  .btn-primary {
    background: #007bff;
    color: white;
  }
  
  .btn-secondary {
    background: #6c757d;
    color: white;
  }
  
  /* é™çº§æ–¹æ¡ˆï¼šåŸºäºçˆ¶å®¹å™¨å®½åº¦çš„åª’ä½“æŸ¥è¯¢ */
  @media screen and (min-width: 768px) {
    .card-container {
      /* æ¡Œé¢ç«¯åŸºç¡€å¸ƒå±€ */
    }
    
    .card {
      display: flex;
      min-height: 200px;
    }
    
    .card-image {
      width: 200px;
      height: auto;
      flex-shrink: 0;
    }
    
    .card-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .card-actions {
      margin-top: auto;
    }
  }
  
  /* å¦‚æœæ”¯æŒå®¹å™¨æŸ¥è¯¢ï¼Œä½¿ç”¨æ›´ç²¾ç¡®çš„æ§åˆ¶ */
  @supports (container-type: inline-size) {
    .card-container {
      container-type: inline-size;
      container-name: card-container;
    }
    
    /* é‡ç½®é™çº§æ ·å¼ */
    @media screen and (min-width: 768px) {
      .card-container .card {
        display: block;
        min-height: auto;
      }
      
      .card-container .card-image {
        width: 100%;
        height: 200px;
      }
    }
    
    /* çœŸæ­£çš„å®¹å™¨æŸ¥è¯¢ */
    @container card-container (min-width: 400px) {
      .card {
        display: flex;
        min-height: 180px;
      }
      
      .card-image {
        width: 150px;
        height: auto;
      }
    }
    
    @container card-container (min-width: 600px) {
      .card {
        display: block;
        min-height: auto;
      }
      
      .card-image {
        width: 100%;
        height: 240px;
      }
      
      .card-content {
        padding: 24px;
      }
    }
    
    @container card-container (min-width: 800px) {
      .card {
        display: flex;
        flex-direction: row-reverse;
        min-height: 220px;
      }
      
      .card-image {
        width: 200px;
        height: auto;
      }
      
      .card-title {
        font-size: 24px;
      }
    }
  }
</style>
</head>
<body>
  <div class="card-container" style="width: 100%; max-width: 1000px; margin: 20px; resize: horizontal; overflow: auto; border: 2px dashed #ccc;">
    <div class="card">
      <img src="https://picsum.photos/400/300" alt="ç¤ºä¾‹å›¾ç‰‡" class="card-image">
      <div class="card-content">
        <h3 class="card-title">å¡ç‰‡æ ‡é¢˜</h3>
        <p class="card-description">è¿™æ˜¯ä¸€ä¸ªå¡ç‰‡æè¿°å†…å®¹ï¼Œä¼šæ ¹æ®å®¹å™¨å®½åº¦è‡ªåŠ¨è°ƒæ•´å¸ƒå±€ã€‚</p>
        <div class="card-actions">
          <button class="btn btn-primary">ä¸»è¦æ“ä½œ</button>
          <button class="btn btn-secondary">æ¬¡è¦æ“ä½œ</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // å®¹å™¨æŸ¥è¯¢é™çº§è„šæœ¬
    if (!CSS.supports('container-type', 'inline-size')) {
      console.log('æµè§ˆå™¨ä¸æ”¯æŒå®¹å™¨æŸ¥è¯¢ï¼Œä½¿ç”¨é™çº§æ–¹æ¡ˆ');
      
      const containers = document.querySelectorAll('.card-container');
      const observer = new ResizeObserver(entries => {
        entries.forEach(entry => {
          const width = entry.contentRect.width;
          const container = entry.target;
          
          // ç§»é™¤æ‰€æœ‰å°ºå¯¸ç±»
          container.classList.remove('cq-sm', 'cq-md', 'cq-lg', 'cq-xl');
          
          // æ ¹æ®å®½åº¦æ·»åŠ ç±»
          if (width < 400) {
            container.classList.add('cq-sm');
          } else if (width < 600) {
            container.classList.add('cq-md');
          } else if (width < 800) {
            container.classList.add('cq-lg');
          } else {
            container.classList.add('cq-xl');
          }
        });
      });
      
      containers.forEach(container => {
        observer.observe(container);
      });
    }
  </script>
</body>
</html>
```

## ğŸ”§ å®ç”¨å·¥å…·å‡½æ•°

### 6. é€šç”¨çš„å®¹å™¨æŸ¥è¯¢é™çº§å·¥å…·

```javascript
/**
 * å®¹å™¨æŸ¥è¯¢é™çº§å·¥å…·
 */
class ContainerQueryPolyfill {
  constructor(options = {}) {
    this.defaultBreakpoints = {
      sm: 400,
      md: 600,
      lg: 800,
      xl: 1000
    };
    
    this.breakpoints = options.breakpoints || this.defaultBreakpoints;
    this.containers = new Map();
    this.observer = new ResizeObserver(this.handleResize.bind(this));
  }
  
  /**
   * åˆå§‹åŒ–å®¹å™¨æŸ¥è¯¢é™çº§
   */
  init(selector = '[data-cq]') {
    if (CSS.supports('container-type', 'inline-size')) {
      console.log('æµè§ˆå™¨æ”¯æŒå®¹å™¨æŸ¥è¯¢ï¼Œæ— éœ€é™çº§');
      return;
    }
    
    const elements = document.querySelectorAll(selector);
    elements.forEach(element => {
      this.containers.set(element, {
        currentBreakpoint: null,
        width: element.offsetWidth
      });
      
      this.observer.observe(element);
      this.updateContainerClasses(element);
    });
  }
  
  /**
   * å¤„ç†å®¹å™¨å°ºå¯¸å˜åŒ–
   */
  handleResize(entries) {
    entries.forEach(entry => {
      const element = entry.target;
      const width = entry.contentRect.width;
      
      this.containers.set(element, {
        ...this.containers.get(element),
        width: width
      });
      
      this.updateContainerClasses(element);
    });
  }
  
  /**
   * æ›´æ–°å®¹å™¨ç±»å
   */
  updateContainerClasses(element) {
    const data = this.containers.get(element);
    const width = data.width;
    
    // ç§»é™¤æ‰€æœ‰æ–­ç‚¹ç±»
    Object.keys(this.breakpoints).forEach(bp => {
      element.classList.remove(`cq-${bp}`);
    });
    
    // ç¡®å®šå½“å‰æ–­ç‚¹
    let currentBp = null;
    for (const [bp, minWidth] of Object.entries(this.breakpoints)) {
      if (width >= minWidth) {
        currentBp = bp;
      }
    }
    
    // æ·»åŠ å½“å‰æ–­ç‚¹ç±»
    if (currentBp) {
      element.classList.add(`cq-${currentBp}`);
    }
    
    // æ›´æ–°æ•°æ®
    this.containers.set(element, {
      ...data,
      currentBreakpoint: currentBp
    });
  }
  
  /**
   * é”€æ¯è§‚å¯Ÿå™¨
   */
  destroy() {
    this.observer.disconnect();
    this.containers.clear();
  }
}

// ä½¿ç”¨ç¤ºä¾‹
const cqPolyfill = new ContainerQueryPolyfill({
  breakpoints: {
    mobile: 0,
    tablet: 480,
    desktop: 768,
    wide: 1024
  }
});

// åˆå§‹åŒ–
cqPolyfill.init('.responsive-container');
```

## ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“

1. **æ¸è¿›å¢å¼º**ï¼šå…ˆå†™åŸºç¡€æ ·å¼ï¼Œå†ç”¨ `@supports` å¢å¼º
2. **ç‰¹æ€§æ£€æµ‹**ï¼šç”¨ JavaScript æ£€æµ‹æ”¯æŒæƒ…å†µ
3. **å¤šé‡é™çº§**ï¼šæä¾› CSS åª’ä½“æŸ¥è¯¢å’Œ JavaScript ä¸¤ç§é™çº§æ–¹æ¡ˆ
4. **æ€§èƒ½è€ƒè™‘**ï¼šåˆç†ä½¿ç”¨ ResizeObserverï¼Œé¿å…è¿‡åº¦è§¦å‘
5. **ä»£ç ç»´æŠ¤**ï¼šä¿æŒå®¹å™¨æŸ¥è¯¢å’Œé™çº§æ ·å¼çš„ä¸€è‡´æ€§

**æ¨èæ–¹æ¡ˆ**ï¼šå¯¹äºç”Ÿäº§ç¯å¢ƒï¼Œå»ºè®®ä½¿ç”¨ `@supports` + ResizeObserver çš„ç»„åˆæ–¹æ¡ˆï¼Œæ—¢èƒ½äº«å—ç°ä»£æµè§ˆå™¨çš„ç²¾ç¡®æ§åˆ¶ï¼Œåˆèƒ½ä¿è¯åœ¨è€æµè§ˆå™¨ä¸­çš„åŸºæœ¬åŠŸèƒ½ã€‚